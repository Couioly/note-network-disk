网络之间的通信主要依靠**IP地址**，它可以唯一标识一台计算机。通过**端口**可以访问计算机上的应用程序。**IP**即互联网协议，IP地址是互联网协议提供的一种统一的地址格式，用于唯一标识网络中的**通信实体**，网络中的请求可以根据这个标识找到**具体的通信实体**。互联网协议的两个版本：

- IPv4：由4个字节大小的二进制标识IP地址
- IPv6：由16个字节表示IP地址有$2^{128}$

`localhost` 用于表示**本地设备或计算机**，对应的IPv4是 `127.0.0.1`，而IPv6是 `::1`。这些地址被称为**回送地址**，它们指向本地机器自身，当程序连接到回送地址时，表示程序与本地机器进行通信。

端口时应用程序与外界交流的**出入口**，用于**唯一标识**一个**应用程序**在通信中的位置。通过不同得端口号，不同得应用程序可以在同一个网络接口中通信。端口号得取值范围为1~65535，端口通常分为三类：

- 公认端口0~1023：被预先定义用于特定网络服务和应用；
- 注册端口1024~49151：通常被分配给用户进程或特定应用程序；
- 动态端口49152~65535：通常被动态分配给客户端应用程序。

>[!warning] 注意
>同一台机器不能有两个程序同时使用同一个端口，若端口号被占用，则当前程序将**启动失败**！

## 1 InetAddress类

`java.net`包中提供了`InetAddress`类用于代表IP地址，该类未提供公开得构造方法，而是提供**静态方法**来获取InetAddress类对象。如下：

|                    方法声明                    |                  功能描述                  |
| :----------------------------------------: | :------------------------------------: |
| `satic InetAddress getByName(String host)` | 获取host对应得InetAddress对象，host可以为主机名或IP地址 |
|    `static InetAddress getLocalHost()`     |          获取本地主机得InetAddress对象          |
|           `String getHostName()`           |             获取当前IP地址对象得主机名             |
|     `boolean isReachable(int timeout)`     |   判断在指定毫秒内是否可以联通该IP地址对应的主机，连通返回true    |
|         `String getHostAddress()`          |              获取字符串格式的IP地址              |

```java
public static void main(String[] args) throws IOException {  
    InetAddress localAddress = InetAddress.getLocalHost();  
    System.out.println("本机IP地址：" + localAddress.getHostAddress());  
    InetAddress bdAddress = InetAddress.getByName("www.baidu.com");  
    System.out.println("百度IP地址：" + bdAddress.getHostAddress());  
    System.out.println("百度主机名：" + bdAddress.getHostName());  
    System.out.println("百度是否可达：" + bdAddress.isReachable(3000));  
}
```

>[!bug] 异常处理
>上述方法中`getLocalHost()`和`isReachable()`方法必须设定抛出异常类，分别为`UnkownHostException`和`IOException`异常，其中`UnkownHostException`是`IOException`类的子类。

## 2 网络通信协议

网络通信协议存在两套参考模型：**OSI参考模型**和**TCP/IP参考模型**。ICP/IP(传输控制协议/因特网互联协议)，由于Internet网络体系结构以TCP/IP协议为核心，所以该模型应用广泛。关于网络通信协议的更多笔记前往网络安全部分——[点击跳转至 L1-5 网络基础协议](../网络安全/L1%20网安基础篇/L1-5%20网络基础协议.md)

在TCP/IP参考模型中，网络互联层和网络接入层主要用于处理网络编程和操作系统级别的功能，这些层次的内容超出了Java的设计范围，因此，基于CS架构进行Java网络编程时，主要关注的是传输层中的UDP和TCP这两个协议。

### 2.1 UDP通信

UDP是一种**无连接**的通信协议，发送端和接收端在数据传输时，**不建立逻辑连接**。UDP具有**资源消耗小、通信效率高、延迟低**的特点，通常在**音频、视频和普通数据传输**中使用。由于UDP无法保证数据的完整性，所以在传输**重要数据**时不建议使用UDP。

JDK在`java.net`包中提供了`DatagramPacket`类，该类实例对象用于**承载**发送或接收的数据。此外，JDK还提供了`DatagramSocket`类，该类可以发送和接收`Datagrampacket`数据包。

#### 2.1.1 DatagramPacket类

`DatagramPacket`类用于**封装**UDP通信中的**数据**，DatagramPacket对象也称**报文对象**。在发送端和接收端创建DatagramPacket对象时，使用的构造方法不同：

- 接收端：DatagramPacket对象只需**接收一个字节数组**来存放接收到的数据
- 发送端：DatagramPacket对象不但要存放被发送的数据，还要指定数据的目标IP地址和端口号

**DatagramPacket类的构造方法**：

|                               构造方法                                | 说明                                                |
| :---------------------------------------------------------------: | :------------------------------------------------ |
|              `DatagramPacket(byte[] buf,int length)`              | 接收长度为length的数据包，length<=buf.length                |
|        `DatagramPacket(byte[] buf,int offset,int length)`         | offect用于指定传入数据包缓冲区buf的偏移量为offset，即从offset位置开始接收数据 |
| `DatagramPacket(byte[] buf,int length,InetAddress addr,int port)` | 将数据包数据buf中length长度的数据发送到指定主机的指定端口号                |
| `DatagramPacket(byte[] buf,int offset,InetAddress addr,int port)` | offset用于指定一个数组中发送数据的偏移量为offset，即从offset位置开始发送数据   |
**DatagramPacket类提供了一些用于操作UDP通信的方法，其中常用的方法如下：**

|            方法声明            | 功能描述               |
| :------------------------: | ------------------ |
| `InetAddress getAddress()` | 用于获取发送端或接收端的IP地址   |
|      `int getPort()`       | 用于获取发送端或者接收端的端口号   |
|     `byte[] getData()`     | 用于获取将要发送或者接收到的数据   |
|     `int getLength()`      | 用于获取要发送或者接收到的数据的长度 |
