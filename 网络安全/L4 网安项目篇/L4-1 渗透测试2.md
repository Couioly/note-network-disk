
**渗透测试中的信息收集**

主要涉及利用 Google Hacking、网络资产测绘平台、whois 查询及 ICP 备案信息等多种方法，收集目标的网络信息。通过使用子域名收集工具、Web 指纹识别工具以及目录扫描工具，可以深入了解目标网站的结构和技术栈。最后，利用 Nmap 进行端口扫描，识别开放服务。这些方法和工具结合起来，构成了一套完整的信息收集流程。

## 1 资产收集

从各个平台选取的目标一般只有公司名称，此时需要根据公司名称进行信息收集，来找寻对应的资产。常用的资产收集手段包括：

- **企查查/天眼查**：获取子公司、关联域名、备案信息等。
- **ICP备案查询**：通过工信部备案系统收集网站、APP、小程序等资产。


## 2 Google Hacking

利用各种高级搜索语法或者搜索指令，让我们能够使用谷歌进行精确化的搜索，外贸找客户和学术文件查找都可以应用到这些搜索技巧。

谷歌搜索语法介绍：[https://cloud.tencent.com/developer/article/2124035](https://cloud.tencent.com/developer/article/2124035)

基础语法：

|搜索语法|用途说明|示例|
|---|---|---|
|`allintext`|查找网页正文中包含所有指定关键词的页面。|`allintext:手机 摄影`|
|`allintitle`|查找网页标题中包含所有指定关键词的页面。|`allintitle:旅游攻略`|
|`inurl`|查找 URL 中包含指定关键词的页面。|`inurl:科技`|
|`inanchor`|查找锚文本（链接文字）中包含指定关键词的页面。|`inanchor:点击这里`|
|`intitle`|查找网页标题中包含指定关键词的页面（与 allintitle 略有不同）。|`intitle:健康生活`|
|`filetype`|查找特定类型的文件。|`filetype:pdf 英语学习`|
|`site`|在指定网站中查找相关信息。|`site:example.com 手机`|
|`-`（减号）|排除包含指定关键词的搜索结果。|`手机 -苹果`|
|`OR`|查找包含任一关键词的页面（关键词之间必须大写，并有空格）。|`手机 OR 平板`|
|`""`（双引号）|精确匹配搜索短语，查找完全一致的内容。|`"北京奥运会"`|
|`*`（通配符）|作为通配符使用，可替代任意词（有使用限制）。|`搜索*擎`|
|`define`|查找某个词汇的定义或解释。|`define:自由落体`|
|`related`|查找与某网页内容相似的其他网页。|`related:www.baidu.com`|
|`info`|获取某个网页的基本信息。|`info:www.example.com`|

常见案例：

|搜索语法|作用|
|---|---|
|`site:edu.cn filetype:xls “身份证”`|查找教育机构的带有“身份证”字段的excel表格|
|`inurl:phpmyadmin/index.php?server=1`|查找phpmyadmin登录页|
|`inurl:info.php intext:”PHP Version” intitle:”phpinfo()`|查找展示phpinfo()的站点|
|`inurl:”.php?id=” “You have an error in your SQL syntax”`|查找可能存在SQL注入的站点|
|`intitle:后台登陆 inurl:http:`|查找登录页为http的站点|
|`intitle:”index of” intext:”Last modified”`|查找存在目录遍历的站点|
|`site:gov.cn filetype:xls 密码`|查找中国政府网站上含“密码”字段的 Excel 表格|
|`intitle:"index of" "config.php"`|查找可公开访问的目录中包含敏感配置文件 config.php|
|`filetype:log intext:"password"`|查找可能泄露了密码信息的日志文件|
|`inurl:admin/login intext:"用户名" intext:"密码"`|查找可能暴露了登录界面的后台|
|`intitle:"webcamXP" inurl:8080`|查找未加保护的视频监控页面（使用 webcamXP）|
|`inurl:wp-content/uploads filetype:sql`|查找 WordPress 网站上传目录中的 SQL 数据库文件|
|`intitle:"Apache2 Ubuntu Default Page" "It works"`|查找未配置完成的 Apache2 默认站点页面|
|`site:pastebin.com intext:"database dump"`|查找 Pastebin 上泄露的数据库转储信息|
|`inurl:login filetype:asp`|查找 ASP 网站的登录页面|
|`inurl:"/proc/self/cwd"`|查找暴露 Linux 服务器目录结构的 Web 应用路径|

> 注意：频繁进行Google Hacking会被谷歌识别为异常流量而进行人机验证

## 3 网络空间资产测绘平台

### 3.1 Shodan

官网(需登录使用)：[https://www.shodan.io/](https://www.shodan.io/)       使用教程：[点击访问](https://www.freebuf.com/articles/others-articles/306789.html)

![[Pasted image 20251105142008.png]]

常见案例：

| 搜索语法                                         | 作用                        |
| -------------------------------------------- | ------------------------- |
| `Hikvision-Webs country:cn city:changsha`    | 搜索长沙的海康威视摄像头后台页           |
| `port:3389 country:cn city:beijing`          | 搜索北京的开启了RDP的服务器           |
| `vuln:CVE-2017-0144 country:cn`              | 搜索存在永恒之蓝漏洞的中国设备(漏洞搜索需要付费) |
| `country:cn city:changsha nginx`             | 搜索长沙的Nginx服务器             |
| `isp:huawei country:cn`                      | 搜索华为的基础设施设备               |
| `title:"index of"`                           | 搜索目录索引页面，常用于探测可浏览的文件目录    |
| `port:21 anonymous ok`                       | 搜索允许匿名登录的FTP服务器           |
| `product:MongoDB port:27017 -authentication` | 搜索未开启身份验证的MongoDB数据库      |

### 3.2 FOFA

官网：[https://fofa.info/](https://fofa.info/)

![[Pasted image 20251105142547.png]]

基础语法：

```fofa
逻辑连接符
 
=    匹配，=""时，可查询不存在字段或者值为空的情况。
==   完全匹配，==""时，可查询存在且值为空的情况。
&&   与  
||   或者
!=   不匹配，!=""时，可查询值为空的情况。
*=   模糊匹配，使用*或者?进行搜索，比如banner*="mys??" (个人版及以上可用)。
()   确认查询优先级，括号内容优先级最高。
 
 
title="beijing"                   从标题中搜索“北京”
 
header="elastic"                  从http头中搜索“elastic”

body="网络空间测绘"                从html正文中搜索“网络空间测绘”

fid="sSXXGNUO2FefBTcCLIT/2Q=="    查找相同的网站指纹
 
domain="qq.com"                   搜索根域名带有qq.com的网站

icp="京ICP证030173号"             查找备案号为“京ICP证030173号”的网站
 
js_name="js/jquery.js"           查找网站正文中包含js/jquery.js的资产
 
js_md5="82ac3f14327a8b7ba49baa208d4eaa15"   查找js源码与之匹配的资产

cname="ap21.inst.siteforce.com"  查找cname为"ap21.inst.siteforce.com"的网站

cname_domain="siteforce.com"     查找cname包含“siteforce.com”的网站

cloud_name="Aliyundun"           通过云服务名称搜索资产

product="NGINX"                  搜索此产品的资产
 
category="服务"                  搜索此产品分类的资产
 
icon_hash="-247388890"           搜索使用此 icon 的资产
 
host=".gov.cn"                   从url中搜索”.gov.cn”搜索要用host作为名称
port="6379"                      查找对应“6379”端口的资产

ip="1.1.1.1"                     从ip中搜索包含“1.1.1.1”的网站搜索要用ip作为名称
ip="220.181.111.1/24"            查询IP为“220.181.111.1”的C网段资产

status_code="402"                查询服务器状态为“402”的资产
 
protocol="quic"                  查询quic协议资产
 
country="CN"                     搜索指定国家(编码)的资产

region="Xinjiang Uyghur Autonomous Region"   搜索指定行政区的资产

city="Ürümqi"                    搜索指定城市的资产

cert="baidu"                    搜索证书(https或者imaps等)中带有baidu的资产

cert.subject="Oracle Corporation" 搜索证书持有者是Oracle Corporation的资产

cert.issuer="DigiCert"            搜索证书颁发者为DigiCert Inc的资产

cert.is_valid=true                验证证书是否有效，true有效，false无效
 
cert.is_match=true                证书和域名是否匹配；true匹配、false不匹配
 
cert.is_expired=false             证书是否过期；true过期、false未过期
 
jarm="2ad...83e81"                搜索JARM指纹

banner="users" && protocol="ftp"  搜索FTP协议中带有users文本的资产

type="service"                    搜索所有协议资产，支持subdomain和service两种
 
os="centos"                       搜索CentOS资产

server=="Microsoft-IIS/10"        搜索IIS 10服务器

app="Microsoft-Exchange"          搜索Microsoft-Exchange设备

after="2017" && before="2017-10-01" 时间范围段搜索

asn="19551"                        搜索指定asn的资产

org="LLC Baxet"                   搜索指定org(组织)的资产

base_protocol="udp"               搜索指定udp协议的资产
 
is_domain=true                    搜索域名的资产,只接受true和false
is_cloud=true                     筛选使用了云服务的资产

port_size="6"                     查询开放端口数量等于"6"的资产
 
port_size_gt="6"                  查询开放端口数量大于"6"的资产
 
port_size_lt="12"                  查询开放端口数量小于"12"的资产
 
ip_ports="80,161"                  搜索同时开放80和161端口的ip

ip_country="CN"                    搜索中国的ip资产

ip_region="Zhejiang"               搜索指定行政区的ip资产(以ip为单位的资产数据)
 
ip_city="Hangzhou"                 搜索指定城市的ip资产(以ip为单位的资产数据)
 
ip_after="2021-03-18"              搜索2021-03-18以后的ip资产

ip_before="2019-09-09"             搜索2019-09-09以前的ip资产
```

**FOFA搜索**

1. 查找未授权访问漏洞

```fofa
title="401 Unauthorized" || title="403 Forbidden" || title="404 Not Found"
```

>[!info] 说明
>搜索401、403或404状态码的页面，可能存在未授权访问漏洞

- `title="401 Unauthorized"`：搜索返回 401（未授权） 状态的页面，通常需要登录但未认证。
- `title="403 Forbidden"`：搜索返回 403（禁止访问） 的页面，可能涉及权限问题。
- `title="404 Not Found"`：搜索返回 404（未找到） 的页面，可能暴露敏感路径或错误配置。
- `||` 表示逻辑 “或”，即满足任意一个条件即可匹配。

2. 查找弱口令漏洞

```fofa
body="<input type=\"password\""
```

>[!info] 说明
>搜索包含密码输入框的页面，可能存在弱口令漏洞

3. 查找文件上传漏洞

```fofa
title="Upload" && body="form enctype=multipart/form-data method=post"
```

>[!info] 说明
>搜索包含文件上传表单的页面，可能存在文件上传漏洞

- `title="Upload"`：页面标题包含 “Upload”（可能是文件上传功能）。
- `body="form enctype=multipart/form-data method=post"`：表单使用 multipart/form-data（文件上传专用格式）。

4. 查找CMS漏洞

```fofa
title="Powered by WordPress" || title="Powered by Joomla" || title="Powered by Drupal"
```

>[!info] 说明
>搜索 WordPress、Joomla、Drupal 等 CMS（内容管理系统）的页面。
>这些 CMS 有大量已知漏洞（如插件漏洞、RCE、SQL注入等）。

5. 查找Web漏洞

```fofa
title="404 Not Found" || title="403 Forbidden" || title="401 Unauthorized" || title="500 Internal Server Error" || title="502 Bad Gateway" || title="503 Service Unavailable" || title="SQL Error" || title="ASP.NET Error"
```

搜索各种 HTTP 错误页面：
- `401/403/404`：权限或路径问题。
- `500/502/503`：服务器错误（可能暴露后端信息）。
- `SQL Error`：数据库错误（可能存在 SQL 注入）。
- `ASP.NET Error`：ASP.NET 错误（可能泄露敏感信息）。

6. 查找未加密的数据库

```fofa
title="phpMyAdmin" || title="MySQL" || title="phpPgAdmin" || title="PostgreSQL" || title="Microsoft SQL Server" && body="input type=password"
```

>[!info] 说明
>搜索数据库管理页面且包含密码输入框，可能存在未加密的数据库

- 搜索 数据库管理工具（如 phpMyAdmin、PostgreSQL 管理界面）
- `body="input type=password"`：包含密码输入框（通常是登录界面）

7. 查找存储型XSS漏洞

```fofa
body="textarea" && body="input type=text" && body="input type=password"
```

>[!info] 说明
>搜索包含文本输入框和密码输入框的页面，这些通常是表单提交页面，可能存在存储型XSS漏洞

常见案例：

| 搜索语法                                                                                                                          | 作用                    |
| ----------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| body="{\"hello\":\"clash\"}" \|\| body="{\"hello\":\"clash.meta\"}" \|\| port="9090" && body="{\"message\":\"Unauthorized\"}" | 查找Clash的RESTful API接口 |
| ip="119.29.29.29/24"                                                                                                          | 查C段信息                 |
| icon_hash="-1825654886" && country=CN                                                                                         | 查找图标哈希                |
| body="自动抓取tg频道、订阅地址"                                                                                                          | 查找公开节点池               |
| protocol="socks5" && country="CN" && banner="Method:No Authentication"                                                        | 查找公开的socks5代理         |
### 3.3 情报社区(微步在线)

官网（需登录）：[https://x.threatbook.com/v5/mapping](https://x.threatbook.com/v5/mapping)

```
icp_name="微步在线"
```

![[Pasted image 20251105180822.png]]

### 3.4 ZoomEye(钟馗之眼)

官网：[https://www.zoomeye.org/](https://www.zoomeye.org/)

可以直接用它自在的搜索工具组合不同条件进行搜索

```
domain="zoomeye.org"
```

![[Pasted image 20251105181207.png]]

### 3.5 Hunter(奇安信)

官网：[https://hunter.qianxin.com/](https://hunter.qianxin.com/)

```
domain.suffix="qianxin.com"
```

![[Pasted image 20251105181525.png]]

---

**了解更多网络空间资产测绘平台以及威胁情报平台，可参考下面两篇文章：**

- https://mp.weixin.qq.com/s/1v9y1Ib2ckIlo5eaxS_R-g
- https://mp.weixin.qq.com/s/Ye0eE15b6S-V2Ohh3tOqug

## 4 whois和ICP备案

### 4.1 whois

**作用**：

- **域名所有权验证**：获取域名注册者、注册商、注册日期、过期时间、DNS服务器等信息。
- **网络安全调查**：帮助识别恶意网站、钓鱼域名的持有者或关联域名。
- **法律取证**：在侵权、诈骗等案件中追踪责任方。
    
**Web搜索**

爱站网：[https://whois.aizhan.com/](https://whois.aizhan.com/)  
站长之家：[https://whois.chinaz.com/](https://whois.chinaz.com/)  
CNNIC(推荐查`.cn`域名)：[https://webwhois.cnnic.cn/WhoisServlet](https://webwhois.cnnic.cn/WhoisServlet)

> [!info] Web搜索优势
> Web搜索whois信息相比较于命令行搜索的优势在于关键信息优化排版且汉化显示，有的还可以反查ICP备案、解析地址等信息；部分站点查询到的whois信息为缓存信息，最新信息可以通过其提供的更新按钮获取。

![[Pasted image 20251105182652.png]]

### 4.2 ICP备案

**作用**：

- **合规性核查**：中国法律规定，所有在中国境内运营的网站必须完成ICP备案，否则无法接入国内服务器。
- **主体真实性**：备案信息包括主办单位名称、负责人、备案号、网站用途等，需提交企业/个人实名资料。
- **信任背书**：备案号通常显示在网站底部，增强用户对正规网站的信任。

工信部服务平台：[https://beian.miit.gov.cn/#/Integrated/recordQuery](https://beian.miit.gov.cn/#/Integrated/recordQuery)  
爱站网：[https://icp.aizhan.com/](https://icp.aizhan.com/)  
站长之家：[https://icp.chinaz.com/](https://icp.chinaz.com/)

![[Pasted image 20251105182817.png]]

>[!info] 说明
>`.cn`域名没有whois隐私保护(whois protection)，会泄露注册人的真实姓名以及邮箱地址，如果是企业注册的，则会泄露企业名称，可以结合天眼查查他的法定代表人姓名，最后再根据已知信息使用社工库进行查找。
>
>社工库不会找？用前面教的Google Hacking：`inurl:t.me intitle:社工库`

## 5 子域名收集

### 5.1 Google Hacking

```
site:domain
```

